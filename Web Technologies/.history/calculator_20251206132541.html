<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Beautiful Scientific Calculator</title>
  <style>
    :root{
      --bg1: #0f1724; /* deep navy */
      --bg2: #081229; /* darker */
      --glass: rgba(255,255,255,0.06);
      --accent: linear-gradient(135deg,#7c3aed,#06b6d4);
      --btn: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.45);
      --success: #10b981;
      --danger: #ef4444;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent),
                  radial-gradient(900px 400px at 90% 90%, rgba(6,182,212,0.08), transparent),
                  linear-gradient(180deg,var(--bg1), var(--bg2));
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .calculator{
      width:380px;
      max-width:95vw;
      border-radius:18px;
      backdrop-filter: blur(8px) saturate(120%);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .logo{
      width:44px;height:44px;border-radius:10px;
      background: var(--accent);
      display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;color:white;box-shadow:0 6px 18px rgba(12,8,40,0.45);
    }
    .title{font-size:14px;font-weight:600}
    .subtitle{font-size:11px;color:var(--muted);margin-top:2px}

    .display{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:6px;min-height:84px;box-shadow: inset 0 -4px 30px rgba(0,0,0,0.35);
    }
    .expression{font-size:14px;color:var(--muted);min-height:18px;word-break:break-all}
    .output{font-size:26px;font-weight:600;text-align:right}
    .small-meta{display:flex;gap:8px;align-items:center}
    .meta-chip{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--muted)}

    .pad{
      display:grid;grid-template-columns:repeat(6,1fr);gap:10px;
    }

    button.key{
      border:0;padding:12px;border-radius:10px;background:var(--btn);color:inherit;font-size:15px;font-weight:600;box-shadow:0 6px 12px rgba(2,6,23,0.5);cursor:pointer;transition:all .14s ease;
    }
    button.key:active{transform:translateY(1px) scale(.998)}

    button.op{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    button.eq{grid-column:span 2;background:var(--accent);color:white;font-weight:700}
    button.clear{background:linear-gradient(180deg,#ff5f6d, #f66); color:white}
    button.fn{background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); font-weight:600}

    .wide{grid-column:span 2}
    .dark{color:#cfe9ff}

    .footer{display:flex;align-items:center;justify-content:space-between;font-size:13px;color:var(--muted)}

    /* Responsive tweaks */
    @media (max-width:420px){
      .calculator{width:320px}
      .output{font-size:22px}
      button.key{padding:10px;font-size:14px}
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Scientific calculator">
    <div class="header">
      <div class="brand">
        <div class="logo">SC</div>
        <div>
          <div class="title">Scientific Calculator</div>
          <div class="subtitle">Beautiful, fast & precise</div>
        </div>
      </div>
      <div class="small-meta">
        <div class="meta-chip" id="angleMode">DEG</div>
        <div class="meta-chip" id="memoryChip">M: 0</div>
      </div>
    </div>

    <div class="display" id="display">
      <div class="expression" id="expression" aria-live="polite"></div>
      <div class="output" id="result" aria-live="assertive">0</div>
    </div>

    <div class="pad" id="pad">
      <!-- Row 1 -->
      <button class="key fn" data-value="mc">MC</button>
      <button class="key fn" data-value="mr">MR</button>
      <button class="key fn" data-value="mplus">M+</button>
      <button class="key fn" data-value="mminus">M-</button>
      <button class="key fn" data-value="('">(</button>
      <button class="key fn" data-value=")'">)</button>

      <!-- Row 2 -->
      <button class="key fn" data-value="sin(">sin</button>
      <button class="key fn" data-value="cos(">cos</button>
      <button class="key fn" data-value="tan(">tan</button>
      <button class="key fn" data-value="asin(">asin</button>
      <button class="key fn" data-value="acos(">acos</button>
      <button class="key fn" data-value="atan(">atan</button>

      <!-- Row 3 -->
      <button class="key fn" data-value="ln(">ln</button>
      <button class="key fn" data-value="log(">log</button>
      <button class="key fn" data-value="exp(">eˣ</button>
      <button class="key fn" data-value="^">^</button>
      <button class="key fn" data-value="sqrt(">√</button>
      <button class="key fn" data-value="!">n!</button>

      <!-- Row 4 -->
      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="/">÷</button>
      <button class="key op" data-value="%">%</button>
      <button class="key clear" data-value="C">C</button>

      <!-- Row 5 -->
      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="*">×</button>
      <button class="key op" data-value="**">x²</button>
      <button class="key" data-value="del">⌫</button>

      <!-- Row 6 -->
      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="-">−</button>
      <button class="key op" data-value="pow">xʸ</button>
      <button class="key eq" data-value="=">=</button>

      <!-- Row 7 -->
      <button class="key wide" data-value="0">0</button>
      <button class="key" data-value=".">.</button>
      <button class="key" data-value="+">+</button>
      <button class="key fn" data-value="pi">π</button>
      <button class="key fn" data-value="e">e</button>
    </div>

    <div class="footer">
      <div>Tip: use keyboard — numbers, + - * / and Enter</div>
      <div>Made with ❤️</div>
    </div>
  </main>

  <script>
    (function(){
      const exprEl = document.getElementById('expression');
      const resEl = document.getElementById('result');
      const pad = document.getElementById('pad');
      const angleModeChip = document.getElementById('angleMode');
      const memoryChip = document.getElementById('memoryChip');

      let expression = '';
      let memory = 0;
      let angleMode = 'DEG'; // or 'RAD'

      function updateChips(){
        angleModeChip.textContent = angleMode;
        memoryChip.textContent = `M: ${memory}`;
      }

      function setResult(v){
        resEl.textContent = String(v);
      }
      function setExpression(v){
        exprEl.textContent = v;
      }

      function safeEval(raw){
        // prepare a JS expression from our friendly syntax
        let s = raw;

        // replace common tokens
        s = s.replace(/π/g,'pi');
        s = s.replace(/×/g,'*').replace(/÷/g,'/');

        // handle percent as divide by 100 when used after a number: 50% -> (50/100)
        s = s.replace(/(\d+(?:\.\d+)?)%/g,'($1/100)');

        // replace ^ with **
        s = s.replace(/\^/g,'**');

        // map functions to Math equivalents (we'll wrap trig to handle DEG)
        s = s.replace(/\bexp\(([^)]+)\)/g,'(Math.exp($1))');
        s = s.replace(/\bln\(/g,'(Math.log(');
        s = s.replace(/\blog\(/g,'(Math.log10(');
        s = s.replace(/\bsqrt\(/g,'(Math.sqrt(');
        s = s.replace(/\be\b/g,'Math.E');
        s = s.replace(/\bpi\b/g,'Math.PI');

        // trig: sin( ... ) -> trigWrap('sin', ... )
        s = s.replace(/\b(sin|cos|tan|asin|acos|atan)\(/g, (m,p1)=>{
          return `__TRIG__${p1}(`;
        });

        // factorial: convert n! to fact(n)
        // handle number! or (...)!
        s = s.replace(/(\d+\.?\d*|\([^)]*\))!/g, function(m, p1){
          return `fact(${p1})`;
        });

        // allow '**' x squared mapping preserved; pow keyword will be handled separately
        // pow button inserted as 'pow('...')' where we will convert pow(a,b) -> (a**b)
        s = s.replace(/pow\(/g,'(');

        // sanitize: allow only a limited set of chars
        if(/[^0-9+\-*/()., MathEPIa-zA-Z_%\*\!]/.test(s)){
          // if contains weird chars, reject
          throw new Error('Invalid characters in expression');
        }

        // replace our trig wrappers with real calls that handle DEG/RAD
        function trigWrap(name, inside){
          if(['sin','cos','tan'].includes(name)){
            if(angleMode === 'DEG'){
              return `Math.${name}(((${inside}) * Math.PI)/180)`;
            }else{
              return `Math.${name}(${inside})`;
            }
          }else{ // inverse
            if(['asin','acos','atan'].includes(name)){
              if(angleMode === 'DEG'){
                // result will be converted to degrees
                const base = `Math.${name}(${inside})`;
                return `((${base}) * 180 / Math.PI)`;
              }else{
                return `Math.${name}(${inside})`;
              }
            }
          }
        }

        // replace __TRIG__name( with trig call placeholder then later transform
        s = s.replace(/__TRIG__(sin|cos|tan|asin|acos|atan)\(/g, function(m,p1){
          return `__${p1.toUpperCase()}__(`;
        });

        // Now walk and replace each __XXX__( ... ) by trigWrap
        // We need to do this repeatedly to handle nested parentheses; simple approach: replace occurrences
        s = s.replace(/__(sin|cos|tan|asin|acos|atan)__/ig, function(m,p1){
          return `__${p1.toUpperCase()}__`;
        });

        // Replace __SIN__(  with trigWrap('sin',
        // We'll use a small parser to convert __SIN__(...) occurrences
        s = replaceTrigWrappers(s);

        // final wrap: allow Math functions and operators only
        const finalExpr = s;

        // evaluate in a safe Function with limited scope
        const allowed = {
          Math, // provide Math so Math.* works
          fact: fact
        };
        // create function body that returns the expression
        const fn = new Function('Math','fact',`with (Math) { return (${finalExpr}); }`);
        return fn(Math, fact);
      }

      function replaceTrigWrappers(s){
        // pattern __SIN__( ... )
        return s.replace(/__(SIN|COS|TAN|ASIN|ACOS|ATAN)__\(/g, function(m, cap){
          // find matching closing parenthesis for this opening
          const start = s.indexOf(m);
          const after = start + m.length + 1; // position after '('
          let depth = 1; let i = after;
          while(i < s.length && depth > 0){
            if(s[i] === '(') depth++;
            else if(s[i] === ')') depth--;
            i++;
          }
          const inside = s.slice(after, i-1);
          const wrapped = trigWrap(cap.toLowerCase(), inside);
          // replace the whole substring from start to i with wrapped
          return wrapped + s.slice(i);
        }).replace(/__SIN__|__COS__|__TAN__|__ASIN__|__ACOS__|__ATAN__/g,'');

        function trigWrap(name, inside){
          if(['sin','cos','tan'].includes(name)){
            if(angleMode === 'DEG'){
              return `Math.${name}(((${inside}) * Math.PI)/180)`;
            }else{
              return `Math.${name}(${inside})`;
            }
          }else{ // inverse
            if(['asin','acos','atan'].includes(name)){
              if(angleMode === 'DEG'){
                const base = `Math.${name}(${inside})`;
                return `((${base}) * 180 / Math.PI)`;
              }else{
                return `Math.${name}(${inside})`;
              }
            }
          }
        }
      }

      function fact(n){
        // support non-integer factorials? We'll implement gamma for non-integers using approximate Lanczos.
        // For integers, simple loop.
        if(typeof n !== 'number' || !isFinite(n)) throw new Error('Invalid input for factorial');
        if(n < 0) throw new Error('Factorial for negative numbers is undefined');
        // if integer
        if(Math.abs(n - Math.round(n)) < 1e-12){
          n = Math.round(n);
          let res = 1;
          for(let i=2;i<=n;i++) res *= i;
          return res;
        }
        // Lanczos approximation for Gamma(n+1) = factorial(n) for non-integers
        return gamma(n+1);
      }

      function gamma(z){
        // Lanczos approximation
        const p = [676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
        const g = 7;
        if(z < 0.5) return Math.PI / (Math.sin(Math.PI*z) * gamma(1-z));
        z -= 1;
        let x = 0.99999999999980993;
        for(let i=0;i<p.length;i++) x += p[i]/(z+i+1);
        const t = z + g + 0.5;
        return Math.sqrt(2*Math.PI) * Math.pow(t, z+0.5) * Math.exp(-t) * x;
      }

      // Button handling
      pad.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const v = btn.dataset.value;
        handleInput(v);
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter') { e.preventDefault(); handleInput('='); return; }
        if(e.key === 'Backspace') { e.preventDefault(); handleInput('del'); return; }
        if(e.key === 'Escape') { e.preventDefault(); handleInput('C'); return; }
        const keyMap = {
          '/':'/', '*':'*','-':'-','+':'+', '%':'%','.' :'.'
        };
        if(keyMap[e.key]){ handleInput(keyMap[e.key]); return; }
        if(/[0-9]/.test(e.key)){ handleInput(e.key); return; }
      });

      // small helpers
      function handleInput(v){
        try{
          if(v === 'C'){ expression = ''; setExpression(''); setResult(0); return; }
          if(v === 'del'){ expression = expression.slice(0,-1); setExpression(expression); return; }
          if(v === '='){ if(!expression) return; const out = safeEval(expression); setResult(Number.isFinite(out)? tidyNumber(out): out); expression = String(out); setExpression(expression); return; }

          // memory
          if(v === 'mc'){ memory = 0; updateChips(); return; }
          if(v === 'mr'){ expression += String(memory); setExpression(expression); return; }
          if(v === 'mplus'){ const val = Number(resEl.textContent) || 0; memory += val; updateChips(); return; }
          if(v === 'mminus'){ const val = Number(resEl.textContent) || 0; memory -= val; updateChips(); return; }

          // pi and e
          if(v === 'pi'){ expression += 'pi'; setExpression(expression); return; }
          if(v === 'e'){ expression += 'e'; setExpression(expression); return; }

          // angle mode toggle if user clicks the mode chip
          // provide a quick click on angle chip to switch
          if(v === 'DEG' || v === 'RAD') return;

          // power shortcuts
          if(v === '**'){ expression += '**2'; setExpression(expression); return; }
          if(v === '^'){ expression += '^'; setExpression(expression); return; }
          if(v === 'pow'){ expression += '^'; setExpression(expression); return; }

          // functions that already include parentheses
          if(/^(sin\(|cos\(|tan\(|asin\(|acos\(|atan\(|ln\(|log\(|exp\(|sqrt\()/i.test(v)){
            expression += v;
            setExpression(expression);
            return;
          }

          // default: append the value
          expression += v;
          setExpression(expression);
        }catch(err){
          setResult('Error');
          console.error(err);
        }
      }

      function tidyNumber(x){
        if(typeof x !== 'number') return x;
        if(!isFinite(x)) return x;
        // round to sensible precision
        const rounded = Math.round(x * 1e12)/1e12;
        return rounded;
      }

      // angle mode click handler
      angleModeChip.addEventListener('click', ()=>{
        angleMode = (angleMode === 'DEG') ? 'RAD' : 'DEG';
        updateChips();
      });

      // expression click to paste last result
      exprEl.addEventListener('click', ()=>{
        if(resEl.textContent && resEl.textContent !== '0'){
          expression += resEl.textContent;
          setExpression(expression);
        }
      });

      // init
      setExpression(''); setResult(0); updateChips();

    })();
  </script>
</body>
</html>
