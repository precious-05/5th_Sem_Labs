@page "/"
@using HealthMateLite.Models
@using HealthMateLite.Services
@inject HealthDataService DataService

<PageTitle>Health Mate - Dashboard</PageTitle>

<div class="dashboard-container">
    <div class="welcome-section">
        <h1>🏥 Welcome to Health Mate</h1>
        <p class="lead">Your simple health tracking companion</p>
    </div>

    <AuthorizeView>
        <Authorized>
            @{
                var username = context.User.Identity?.Name ?? "";
                var recentMetrics = DataService.GetHealthMetrics(username).Take(5).ToList();
                var medications = DataService.GetMedications(username);
            }
            
            <div class="quick-stats">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h3>@recentMetrics.Count</h3>
                            <p>Recent Entries</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h3>@medications.Count</h3>
                            <p>Medications</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h3>@GetAverageSleep(recentMetrics)</h3>
                            <p>Avg Sleep (hrs)</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <h3>@GetLatestWeight(recentMetrics)</h3>
                            <p>Latest Weight</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <h2>Quick Actions</h2>
                <div class="row">
                    <div class="col-md-6">
                        <a href="/health-metrics" class="action-card">
                            <h4>➕ Add Health Entry</h4>
                            <p>Record your daily health metrics</p>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/medications" class="action-card">
                            <h4>💊 Manage Medications</h4>
                            <p>Add or remove your medications</p>
                        </a>
                    </div>
                </div>
            </div>
        </Authorized>
        <NotAuthorized>
            <div class="alert alert-info text-center">
                <h3>Please login to continue</h3>
                <p>Use the login button in top right corner to access your health data.</p>
                <a href="/login" class="btn btn-primary mt-3">Go to Login</a>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private string GetAverageSleep(List<HealthMetric> metrics)
    {
        if (metrics.Count == 0) return "0";
        return metrics.Average(m => m.SleepHours).ToString("F1");
    }

    private string GetLatestWeight(List<HealthMetric> metrics)
    {
        var latest = metrics.FirstOrDefault();
        return latest != null ? $"{latest.Weight} kg" : "N/A";
    }
}